<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vanguard Signals — Checkout</title>

  <link rel="icon" href="logo.png" type="image/png" />
  <link rel="apple-touch-icon" href="logo.png" />

  <script src="https://js.stripe.com/v3/"></script>

  <style>
    :root{
      --bg: #070B10;
      --panel: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --muted2: rgba(255,255,255,0.52);

      /* refined gold */
      --gold: #caa24a;
      --gold2: #b88f3f;
      --goldGlow: rgba(202,162,74,0.18);

      --danger: #ff5a6a;
      --shadow: 0 18px 60px rgba(0,0,0,0.55);
      --radius: 18px;
    }

    *{ box-sizing: border-box; }
    html, body{
      height: 100%;
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 520px at 18% -10%, var(--goldGlow), transparent 55%),
        radial-gradient(900px 520px at 92% 10%, rgba(56,211,159,0.10), transparent 55%),
        linear-gradient(180deg, #06090d 0%, #070b10 100%);
      color: var(--text);
    }

    a{ color: var(--text); text-decoration: underline; }
    .wrap{ max-width: 1120px; margin: 0 auto; padding: 28px 18px 56px; }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom: 18px;
    }

    .brand{ display:flex; align-items:center; gap:12px; min-width: 0; }
    .brand img{
      width: 38px; height: 38px; object-fit: contain;
      border-radius: 10px;
      background: rgba(255,255,255,0.04);
      padding: 6px;
      border: 1px solid rgba(255,255,255,0.10);
    }
    .brand .name{ display:flex; flex-direction:column; line-height:1.1; }
    .brand .name strong{ font-size:14px; letter-spacing:0.4px; }
    .brand .name span{ font-size:12px; color: var(--muted); }

    .toplinks{ display:flex; gap:12px; flex-wrap:wrap; justify-content:flex-end; }
    .pill{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      text-decoration: none;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap: 18px;
      align-items:start;
      margin-top: 18px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
      header{ flex-direction:column; align-items:flex-start; }
      .toplinks{ justify-content:flex-start; }
    }

    .card{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.045));
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }
    .card .hd{
      padding: 18px 18px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.09);
      background: rgba(0,0,0,0.18);
    }
    .card .hd h1, .card .hd h2{ margin:0; font-size:18px; letter-spacing:0.3px; }
    .card .hd p{ margin:8px 0 0; font-size:13px; color: var(--muted); line-height:1.45; }
    .card .bd{ padding: 18px; }

    .notice{
      border: 1px solid rgba(202,162,74,0.35);
      background: rgba(202,162,74,0.10);
      padding: 12px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.45;
      color: rgba(255,255,255,0.88);
    }
    .notice .fine{ margin-top:8px; color: rgba(255,255,255,0.72); font-size:12px; }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:14px; }
    @media (max-width:520px){ .row{ grid-template-columns:1fr; } }

    label{ display:block; font-size:12px; color: var(--muted); margin:0 0 8px; letter-spacing:0.2px; }

    input[type="text"], input[type="tel"], input[type="email"], select{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline:none;
    }
    select { appearance: none; }
    input::placeholder{ color: rgba(255,255,255,0.35); }
    input:focus, select:focus{
      border-color: rgba(202,162,74,0.55);
      box-shadow: 0 0 0 3px rgba(202,162,74,0.12);
    }

    .stripe-field{
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
    }

    .checkbox{
      display:flex; align-items:flex-start; gap:10px;
      margin-top:14px;
      padding:12px;
      border-radius:14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .checkbox input{ margin-top: 3px; }
    .checkbox span{ font-size:12px; color: rgba(255,255,255,0.78); line-height:1.45; }

    .btn{
      margin-top: 14px;
      width: 100%;
      padding: 14px 16px;
      border-radius: 14px;
      border: 1px solid rgba(202,162,74,0.55);
      background: linear-gradient(180deg, rgba(202,162,74,0.95), rgba(184,143,63,0.85));
      color: #101010;
      font-weight: 900;
      letter-spacing: 0.2px;
      cursor: pointer;
      transition: transform .08s ease, filter .12s ease, box-shadow .12s ease;
      box-shadow: 0 10px 30px rgba(202,162,74,0.16);
    }
    .btn:hover{ filter: brightness(1.03); box-shadow: 0 12px 34px rgba(202,162,74,0.20); }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{ opacity: 0.65; cursor: not-allowed; }

    #card-errors{ margin-top:10px; color: var(--danger); font-size:12px; min-height: 16px; }

    .summary{ display:flex; flex-direction:column; gap:12px; }
    .pricebox{
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      border-radius: 16px;
      padding: 14px;
    }
    .pricebox .top{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .pricebox .title{ font-weight:800; font-size:14px; }
    .pricebox .tag{
      font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(202,162,74,0.55);
      background: rgba(202,162,74,0.10);
      color: rgba(255,255,255,0.90);
      white-space:nowrap;
    }
    .pricebox .big{ font-size:28px; font-weight:900; margin:10px 0 4px; letter-spacing:0.2px; }
    .pricebox .big small{ font-size:12px; color: var(--muted); font-weight:700; margin-left:6px; }

    ul.bullets{ margin:10px 0 0; padding:0 0 0 18px; font-size:13px; line-height:1.5; color: rgba(255,255,255,0.82); }
    ul.bullets li{ margin:6px 0; }

    .muted{ color: var(--muted); font-size:12px; line-height:1.45; margin-top:10px; }
    .divider{ height:1px; background: rgba(255,255,255,0.10); margin:16px 0; }

    footer{ margin-top:18px; color: var(--muted2); font-size:12px; line-height:1.45; }
    footer .links{ display:flex; gap:12px; flex-wrap:wrap; margin-top:8px; }
    footer .links a{ color: rgba(255,255,255,0.72); }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img src="logo.png" alt="Vanguard Signals Logo" />
        <div class="name">
          <strong>Vanguard Signals</strong>
          <span>Secure Checkout</span>
        </div>
      </div>
      <div class="toplinks">
        <a class="pill" href="https://vanguard-signals.xyz" rel="noopener">Back to site</a>
        <span class="pill">Daily subscription • 1-day free trial</span>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="hd">
          <h1>Complete your subscription</h1>
          <p>
            This is a <strong>daily subscription</strong>. You get <strong>1 day free</strong> (trial).
            After the trial ends, you will be charged <strong>US$25/day</strong> automatically until you cancel.
          </p>
        </div>

        <div class="bd">
          <div class="notice">
            <strong>Billing terms (required disclosure):</strong><br/>
            <b>1-day free trial</b> → then <b>US$25 per day</b> with <b>automatic daily renewal</b>.
            Cancel anytime to avoid future charges.
            <div class="fine">
              No investment advice. Trading involves risk and may result in losses.
            </div>
          </div>

          <form id="payment-form" autocomplete="on">
            <div class="row">
              <div>
                <label for="full-name">Full name</label>
                <input id="full-name" name="NAME" type="text" placeholder="John Doe" required />
              </div>
              <div>
                <label for="phone">Phone</label>
                <input id="phone" name="PHONE" type="tel" placeholder="+1 555 123 4567" required />
              </div>
            </div>

            <div class="row">
              <div style="grid-column: 1 / -1;">
                <label for="email">Email</label>
                <input id="email" name="EMAIL" type="email" placeholder="you@example.com" required />
              </div>
            </div>

            <!-- ✅ Billing Address -->
            <div class="row">
              <div style="grid-column: 1 / -1;">
                <label for="addr1">Billing address (line 1)</label>
                <input id="addr1" name="ADDR1" type="text" placeholder="123 Main St" required />
              </div>
            </div>

            <div class="row">
              <div style="grid-column: 1 / -1;">
                <label for="addr2">Billing address (line 2) (optional)</label>
                <input id="addr2" name="ADDR2" type="text" placeholder="Apt, suite, unit, etc. (optional)" />
              </div>
            </div>

            <div class="row">
              <div>
                <label for="city">City</label>
                <input id="city" name="CITY" type="text" placeholder="New York" required />
              </div>
              <div>
                <label for="state">State / Province</label>
                <input id="state" name="STATE" type="text" placeholder="NY" />
              </div>
            </div>

            <div class="row">
              <div>
                <label for="zip">ZIP / Postal code</label>
                <input id="zip" name="ZIP" type="text" placeholder="10001" required />
              </div>
              <div>
                <label for="country">Country</label>
                <select id="country" name="COUNTRY" required>
                  <option value="" selected disabled>Select country</option>
                  <option value="US">United States</option>
                  <option value="BR">Brazil</option>
                  <option value="CA">Canada</option>
                  <option value="GB">United Kingdom</option>
                  <option value="AU">Australia</option>
                  <option value="MX">Mexico</option>
                  <option value="AR">Argentina</option>
                  <option value="CL">Chile</option>
                  <option value="CO">Colombia</option>
                  <option value="PE">Peru</option>
                  <option value="PT">Portugal</option>
                  <option value="ES">Spain</option>
                  <option value="DE">Germany</option>
                  <option value="FR">France</option>
                  <option value="IT">Italy</option>
                  <option value="NL">Netherlands</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div style="grid-column: 1 / -1;">
                <label for="card-holder-name">Name on card</label>
                <input id="card-holder-name" type="text" placeholder="John Doe" required />
              </div>
            </div>

            <div class="row">
              <div style="grid-column: 1 / -1;">
                <label>Card number</label>
                <div id="card-number-element" class="stripe-field"></div>
              </div>
            </div>

            <div class="row">
              <div>
                <label>Expiry</label>
                <div id="card-expiry-element" class="stripe-field"></div>
              </div>
              <div>
                <label>CVC</label>
                <div id="card-cvc-element" class="stripe-field"></div>
              </div>
            </div>

            <div class="checkbox">
              <input id="terms-check" type="checkbox" required />
              <span>
                I understand this is a <b>daily subscription</b>. I will receive a <b>1-day free trial</b>,
                and after the trial I will be charged <b>US$25/day</b> with <b>automatic daily renewal</b>
                until I cancel.
              </span>
            </div>

            <button id="payment-button" class="btn" type="submit">
              Start Free Trial (Day 1 Free)
            </button>

            <div class="muted">
              After your free trial ends, you will be charged <b>US$25 per day</b> automatically.
              Cancel anytime to avoid future charges.
            </div>

            <div id="card-errors" role="alert" aria-live="polite"></div>
          </form>

          <footer>
            <div>
              Need help? Contact support: <a href="mailto:support@vanguard-signals.xyz">support@vanguard-signals.xyz</a>
            </div>
            <div class="links">
              <a href="https://vanguard-signals.xyz/" target="_blank" rel="noopener">Terms</a>
              <a href="https://vanguard-signals.xyz/" target="_blank" rel="noopener">Privacy</a>
              <a href="https://vanguard-signals.xyz/" target="_blank" rel="noopener">Cancellation</a>
              <a href="https://vanguard-signals.xyz/" target="_blank" rel="noopener">Refunds</a>
            </div>
          </footer>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="hd">
          <h2>Order summary</h2>
          <p>Transparent subscription details for your confirmation.</p>
        </div>
        <div class="bd summary">
          <div class="pricebox">
            <div class="top">
              <div class="title">Vanguard Signals — Daily Subscription</div>
              <div class="tag">Trial included</div>
            </div>
            <div class="big">US$25<small>/day after trial</small></div>
            <ul class="bullets">
              <li><b>Day 1:</b> Free trial (US$0)</li>
              <li><b>From Day 2:</b> US$25 charged <b>every day</b></li>
              <li><b>Renewal:</b> Automatic daily renewal until you cancel</li>
              <li><b>Cancel:</b> Anytime (to avoid future charges)</li>
            </ul>
          </div>

          <div class="divider"></div>

          <div class="notice" style="border-color: rgba(255,255,255,0.14); background: rgba(255,255,255,0.05);">
            <strong>What you get</strong>
            <div class="fine" style="margin-top:8px;">
              Daily live market coverage, actionable insights, real-time updates, and analysis tools for crypto and stocks.
            </div>
          </div>

          <div class="muted">
            By completing this purchase, you confirm you understand the subscription is billed daily after the free trial.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STRIPE_PUBLIC_KEY = 'pk_live_51Syzy6CDTjZ3C1VR9gx9zxRM4oNrbd0Sc1xTNCLnCr07v8MnRJhTJpNYpFKYVWNyrypBCaWzAbzgXqKCHcuF9Md100WPdV4cdi';
    const BACKEND_URL = "https://59d9-45-134-39-182.ngrok-free.app/api/create-subscription";

    const stripe = Stripe(STRIPE_PUBLIC_KEY);
    const elements = stripe.elements();

    const style = {
      base: {
        fontSize: '16px',
        color: '#EAECEF',
        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
        '::placeholder': { color: '#9aa4b2' }
      },
      invalid: { color: '#ff5a6a', iconColor: '#ff5a6a' }
    };

    const cardNumberElement = elements.create('cardNumber', { style });
    const cardExpiryElement = elements.create('cardExpiry', { style });
    const cardCvcElement = elements.create('cardCvc', { style });

    cardNumberElement.mount('#card-number-element');
    cardExpiryElement.mount('#card-expiry-element');
    cardCvcElement.mount('#card-cvc-element');

    [cardNumberElement, cardExpiryElement, cardCvcElement].forEach(element => {
      element.on('change', function(event) {
        const displayError = document.getElementById('card-errors');
        if (displayError) displayError.textContent = event.error ? event.error.message : '';
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
      const submitButton = document.getElementById('payment-button');

      const billingNameInput  = document.querySelector('input[name="NAME"]');
      const billingPhoneInput = document.querySelector('input[name="PHONE"]');
      const billingEmailInput = document.querySelector('input[name="EMAIL"]');

      // ✅ Address inputs
      const addr1Input   = document.querySelector('input[name="ADDR1"]');
      const addr2Input   = document.querySelector('input[name="ADDR2"]');
      const cityInput    = document.querySelector('input[name="CITY"]');
      const stateInput   = document.querySelector('input[name="STATE"]');
      const zipInput     = document.querySelector('input[name="ZIP"]');
      const countryInput = document.querySelector('select[name="COUNTRY"]');

      const cardHolderNameInput = document.getElementById('card-holder-name');
      const termsCheck = document.getElementById('terms-check');

      if (submitButton) {
        submitButton.addEventListener('click', async function(event) {
          event.preventDefault();

          if (!billingNameInput?.value)  { alert('Please enter your full name.'); return; }
          if (!billingPhoneInput?.value) { alert('Please enter your phone number.'); return; }
          if (!billingEmailInput?.value) { alert('Please enter your email.'); return; }

          if (!addr1Input?.value)   { alert('Please enter your billing address.'); return; }
          if (!cityInput?.value)    { alert('Please enter your city.'); return; }
          if (!zipInput?.value)     { alert('Please enter your ZIP / postal code.'); return; }
          if (!countryInput?.value) { alert('Please select your country.'); return; }

          if (!cardHolderNameInput?.value) { alert('Please enter the name on the card.'); return; }
          if (termsCheck && !termsCheck.checked) { alert('Please confirm you understand the daily subscription terms.'); return; }

          const customerEmail = billingEmailInput.value.trim();

          const billingAddress = {
            line1: addr1Input.value.trim(),
            line2: (addr2Input?.value || '').trim() || undefined,
            city: cityInput.value.trim(),
            state: (stateInput?.value || '').trim() || undefined,
            postal_code: zipInput.value.trim(),
            country: countryInput.value
          };

          submitButton.disabled = true;
          submitButton.textContent = 'Processing...';

          try {
            const { error: pmError, paymentMethod } = await stripe.createPaymentMethod({
              type: 'card',
              card: cardNumberElement,
              billing_details: {
                name: cardHolderNameInput.value.trim(),
                email: customerEmail,
                phone: billingPhoneInput.value.trim(),
                address: billingAddress
              }
            });

            if (pmError) throw new Error(pmError.message);

            const response = await fetch(BACKEND_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                payment_method: paymentMethod.id,
                email: customerEmail,
                name: cardHolderNameInput.value.trim(),
                phone: billingPhoneInput.value.trim(),
                country: billingAddress.country,

                // ✅ send full address to backend too
                address_line1: billingAddress.line1,
                address_line2: billingAddress.line2 || '',
                address_city: billingAddress.city,
                address_state: billingAddress.state || '',
                address_zip: billingAddress.postal_code,

                product_name: 'Vanguard Signals — Daily Subscription (US$25/day after 1-day free trial)',
                amount: 2500,
                trial_period_days: 1
              })
            });

            if (!response.ok) {
              const errorData = await response.json().catch(() => ({}));
              throw new Error(errorData.error || 'Failed to create subscription');
            }

            const subscription = await response.json();

            if (subscription.clientSecret) {
              const { error: confirmError } = await stripe.confirmCardPayment(subscription.clientSecret);
              if (confirmError) throw new Error(confirmError.message);
            }

            window.location.href = 'https://t.me/Miiiinttt';

          } catch (error) {
            console.error('Full error:', error);
            let errorMessage = error.message;
            if (error.message === 'Failed to fetch') {
              errorMessage = 'Could not connect to the server. Please verify the backend is running.';
            }
            alert('Checkout error:\n\n' + errorMessage);
          } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'Start Free Trial (Day 1 Free)';
          }
        });
      }

      const originalForm = document.getElementById('payment-form');
      if (originalForm) originalForm.addEventListener('submit', e => e.preventDefault());
    });
  </script>
</body>
</html>

